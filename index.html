<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Webpage Template</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 10px 0;
            text-align: center;
        }
        nav ul {
            list-style-type: none;
            padding: 0;
        }
        nav ul li {
            display: inline;
            margin: 0 10px;
        }
        nav ul li a {
            color: #fff;
            text-decoration: none;
        }
        main {
            padding: 20px;
        }
        footer {
            background-color: #333;
            color: #fff;
            text-align: center;
            padding: 10px 0;
            position: fixed;
            width: 100%;
            bottom: 0;
        }
    </style>
</head>
<body>
    <header>
        <h1>Welcome to My Website</h1>
        <nav>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </nav>
    </header>

    <h2>Login or Sign Up</h2>
    <input type="email" id="email" placeholder="Email">
    <input type="password" id="password" placeholder="Password">
    <button id="email-signup">Sign Up with Email</button>
    <button id="email-login">Log In with Email</button>
    <button id="google-login">Sign In with Google</button>
    <button id="logout">Log Out</button>
    


    <main>
        <h2>Main Content</h2>
        <p>This is where the main content of the webpage will go.</p>
        <div id="admin-dashboard" style="display: none;">
            <h3>Admin Dashboard</h3>
            <ul id="pending-users"></ul>
        </div>
    </main>
    <footer>
        <p>&copy; 2023 My Website</p>
    </footer>



    
</body>
<script type="module">
    // Import Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
    import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
  
    // Firebase configuration (Replace with your Firebase project settings)
    const firebaseConfig = {
      apiKey: "AIzaSyDGCqsM7CktogM9reSo8k4ubcoc3To0Vwo",
      authDomain: "verse-11f2d.firebaseapp.com",
      projectId: "verse-11f2d",
      storageBucket: "verse-11f2d.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
  
    // Initialize Firebase
    fetch('/firebase-config')
      .then(response => response.json())
      .then(config => {
        const app = initializeApp(config);
        const auth = getAuth();
        const db = getFirestore();
      
        // Google Sign-In Function
        document.getElementById("google-login").addEventListener("click", async () => {
          const provider = new GoogleAuthProvider();
          try {
            const result = await signInWithPopup(auth, provider);
            const user = result.user;
            await saveUserData(user);
            alert(`Welcome, ${user.displayName}!`);
          } catch (error) {
            console.error(error.message);
          }
        });
      
        // Email Sign-Up Function
        document.getElementById("email-signup").addEventListener("click", async () => {
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;
          try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;
            await saveUserData(user);
            alert(`Account created for ${user.email}`);
          } catch (error) {
            console.error(error.message);
          }
        });
      
        // Email Sign-In Function
        document.getElementById("email-login").addEventListener("click", async () => {
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;
          try {
            const userCredential = await signInWithEmailAndPassword(auth, email, password);
            const user = userCredential.user;
            alert(`Welcome back, ${user.email}!`);
          } catch (error) {
            console.error(error.message);
          }
        });
      
        // Logout Function
        document.getElementById("logout").addEventListener("click", async () => {
          try {
            await signOut(auth);
            alert("You have been logged out.");
          } catch (error) {
            console.error(error.message);
          }
        });
      
        // Check if user is admin (for simplicity, assume admin email is hardcoded)
        const adminEmail = "admin@example.com";

        // Show admin dashboard if logged in as admin
        auth.onAuthStateChanged(user => {
            if (user && user.email === adminEmail) {
                document.getElementById('admin-dashboard').style.display = 'block';
                loadPendingUsers();
            }
        });

        // Load pending users
        async function loadPendingUsers() {
            const usersRef = db.collection('users');
            const snapshot = await usersRef.where('status', '==', 'pending').get();
            const pendingUsersList = document.getElementById('pending-users');
            pendingUsersList.innerHTML = '';
            snapshot.forEach(doc => {
                const user = doc.data();
                const li = document.createElement('li');
                li.textContent = `${user.email} - ${user.name}`;
                const approveButton = document.createElement('button');
                approveButton.textContent = 'Approve';
                approveButton.onclick = () => updateUserStatus(doc.id, 'approved');
                const disapproveButton = document.createElement('button');
                disapproveButton.textContent = 'Disapprove';
                disapproveButton.onclick = () => updateUserStatus(doc.id, 'disapproved');
                li.appendChild(approveButton);
                li.appendChild(disapproveButton);
                pendingUsersList.appendChild(li);
            });
        }

        // Update user status
        async function updateUserStatus(userId, status) {
            const userRef = db.collection('users').doc(userId);
            await userRef.update({ status });
            loadPendingUsers();
        }

        // Modify saveUserData to include status
        async function saveUserData(user) {
            const userRef = doc(db, "users", user.uid);
            const userDoc = await getDoc(userRef);

            if (!userDoc.exists()) {
                await setDoc(userRef, {
                    email: user.email,
                    name: user.displayName || "No Name",
                    createdAt: new Date(),
                    status: 'pending' // Set initial status to pending
                });
            }
        }
      });
  </script>
  
</html>
